"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7514],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},p=Object.keys(e);for(n=0;n<p.length;n++)a=p[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)a=p[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var r=n.createContext({}),o=function(e){var t=n.useContext(r),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=o(e.components);return n.createElement(r.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,p=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=o(a),h=i,m=u["".concat(r,".").concat(h)]||u[h]||d[h]||p;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var p=a.length,s=new Array(p);s[0]=u;var l={};for(var r in t)hasOwnProperty.call(t,r)&&(l[r]=t[r]);l.originalType=e,l.mdxType="string"==typeof e?e:i,s[1]=l;for(var o=2;o<p;o++)s[o]=a[o];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3388:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>d,frontMatter:()=>p,metadata:()=>l,toc:()=>o});var n=a(3117),i=(a(7294),a(3905));const p={sidebar_position:9},s="SAGE3 API in SageCell",l={unversionedId:"SAGE3-API-in-SageCell",id:"SAGE3-API-in-SageCell",title:"SAGE3 API in SageCell",description:"Introduction",source:"@site/docs/SAGE3-API-in-SageCell.md",sourceDirName:".",slug:"/SAGE3-API-in-SageCell",permalink:"/docs/SAGE3-API-in-SageCell",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/SAGE3-API-in-SageCell.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"SAGE3 API Usage",permalink:"/docs/API-usage"},next:{title:"Server Deployment",permalink:"/docs/Server-Deployment"}},r={},o=[{value:"Introduction",id:"introduction",level:2},{value:"Setup",id:"setup",level:2},{value:"Coding",id:"coding",level:2},{value:"Python Kernel",id:"python-kernel",level:3},{value:"API Setup",id:"api-setup",level:3},{value:"API Usage",id:"api-usage",level:3},{value:"Create an application",id:"create-an-application",level:3},{value:"Application positioning",id:"application-positioning",level:3},{value:"Opening an asset",id:"opening-an-asset",level:3},{value:"Opening a data file",id:"opening-a-data-file",level:3},{value:"Move and resize applications",id:"move-and-resize-applications",level:3},{value:"Get applications state",id:"get-applications-state",level:3},{value:"API",id:"api",level:2}],c={toc:o};function d(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"sage3-api-in-sagecell"},"SAGE3 API in SageCell"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"The SAGE API is now (partially) exposed in SageCell in Python. That means you can access all the content of the board, create apps, move and resize apps, get state of the apps and modify them, open assets, and more. The kernels are managed by SAGE3's internel JupyterLab instance."),(0,i.kt)("h2",{id:"setup"},"Setup"),(0,i.kt)("p",null,"The first thing to do is to create a Python kernel to run your code. For this, open the 'Kernel' panel from the main menubar. You can move this panel any where on the board. It also sticks to the sides of the window if you resize the SAGE3 client."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/e059b5cb-e5e8-4d2e-8a9f-58c12d4fd72c",alt:"Screenshot 2023-09-20 at 6 27 36 PM"})),(0,i.kt)("p",null,"By default, no kernel are running. You can create public and private kernels to execute your code. Click the 'Create Kernel' button\nand select a kernel type and an alias for your kernel. A private kernel can be only used by you. Also, kernels can only be used in\nthe board they have been created in."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/33fda038-74f4-43ae-a77a-740eae03c0b6",alt:"Screenshot 2023-09-20 at 6 27 43 PM"})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/a2bb45ca-0b04-4bba-8aa1-cfa230b5ea52",alt:"Screenshot 2023-09-20 at 6 27 51 PM"})),(0,i.kt)("p",null,"Now your new kernel is listed in the 'Kernel' panel. Three buttons are available for each kernel:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Create cell"),": will create a 'SageCell' application linked to this kernel of execution. Multiple SageCell can share the same kernel of execution"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Restart kernel"),": restart the Jupyter kernel, if stuck for instane"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Delete kernel"),": delete the kernel from the Jupyter server")),(0,i.kt)("h2",{id:"coding"},"Coding"),(0,i.kt)("h3",{id:"python-kernel"},"Python Kernel"),(0,i.kt)("p",null,"Clicking 'Create Cell' in the 'Kernel' panel, creates a SageCell in the center of the view. The cell is linked to the kernel. You can see the kernel alias (name) in the top of the cell, or when selecting the application, you see the kernel name in the application toolbar. You can switch kernel by selecting another kernel in the pulldown menu."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/225a24fe-d175-40e8-86ec-f608de65e795",alt:"Screenshot 2023-09-20 at 6 27 58 PM"})),(0,i.kt)("p",null,"The cell is empty by default. You can also create cells by uploading (drag/drop) python files (with the extension .py). The python files are stored in the asset manager for later use."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/a0d62571-a808-414b-a426-8fecea6ddd71",alt:"Screenshot 2023-09-20 at 6 28 22 PM"})),(0,i.kt)("p",null,"You can type python code in the cell and evaluate the code by pressing 'Shift-Enter' or the 'Execute' button on the left.\nThe results are shown in the pane below the code. We use the docker image 'jupyter/datascience-notebook' with Python 3.9 and\na variety of python packages are pre-installed (matplotlib, plotly, etc)."),(0,i.kt)("h3",{id:"api-setup"},"API Setup"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/9dbb89f3-6786-46d4-bd88-52eeca18eb08",alt:"Screenshot 2023-09-20 at 6 28 33 PM"})),(0,i.kt)("p",null,"To enable the SAGE3 API inside a cell, you need to import a utility package (PySage3) and a few variables (the room and board identifiers\nand the identifier of the cell you are running in). This is facilitated by the context menu (right-click) in the cell. 'Insert board Variables) just adds the above mentioned variables. The 'Setup SAGE API' clears the cell and adds all the needed code to start interacting\nwith the board."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# Import dependencies\nfrom foresight.config import config as conf, prod_type\nfrom foresight.Sage3Sugar.pysage3 import PySage3\n# Context variables\nroom_id = 'ea45732f-36ce-4cc8-8e07-f6536c4e8779'\nboard_id = '9e87bff1-6946-44eb-87b4-3bb167cb1a7c'\napp_id = 'e83cc1b7-9d81-4a11-b012-b65abd93c9fb'\n# Create a handle to the SAGE3 system\nps3 = PySage3(conf, prod_type)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/0dea571c-ecff-4fcb-9e61-696d2b6a8571",alt:"Screenshot 2023-09-20 at 6 28 44 PM"})),(0,i.kt)("p",null,"The PySage3 API gets you a handle to a series of functions to query the SAGE3 system (more functions will be added over time)."),(0,i.kt)("h3",{id:"api-usage"},"API Usage"),(0,i.kt)("p",null,"For instance, to get the list of running applications (smartbits are utility objects to interact with an application):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"ps3.get_smartbits(room_id, board_id)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/26cb28f4-b485-4643-b90f-ec44aa044897",alt:"Screenshot 2023-09-20 at 6 29 37 PM"})),(0,i.kt)("p",null,"To get information about the current 'cell' application, iterate over the application list and match to the 'app_id' provided:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"applist = ps3.get_smartbits(room_id, board_id)\nfor _, app in applist:\n    if app.app_id == app_id:\n        cell = app\n        psize = [cell.data.position.x, cell.data.position.y, cell.data.size.width, cell.data.size.height]\nprint('Cell position and size', psize)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/e52b129a-5467-4b62-bf7d-755a6cc3174f",alt:"Screenshot 2023-09-20 at 6 30 27 PM"})),(0,i.kt)("h3",{id:"create-an-application"},"Create an application"),(0,i.kt)("p",null,"Having the position and size of the current application (cell), you can now create application on the canvas around the cell"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# Setup a new position\nstickie_w = 600\nstickie_h = 200\npad = 20\n# Position to the right of the current app\nright = {'x': psize[0] + psize[2] + pad, 'y': psize[1], 'z': 0}\n# Create a stickie application\nstate = {\"text\": \"Some python....\", 'color': 'yellow', 'fontSize': '24'}\n# Call to SAGE3 API\nres = ps3.create_app(room_id, board_id, 'Stickie', state, {'size': {'width': stickie_w, 'height': stickie_h, 'depth': 0}, 'position': right})\ninfo = res.json()\nif info['success']:\n    # Save the ID of the application\n    app1 = info['data'][0]['_id']\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/bd5fb63b-5446-4990-8e2e-c6bb4fbc7671",alt:"Screenshot 2023-09-20 at 6 31 19 PM"})),(0,i.kt)("p",null,"You can decide to delete the new application"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"ps3.delete_app(app1)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/746cd300-49e2-4b24-885e-4fcb93ccf33d",alt:"Screenshot 2023-09-20 at 6 32 22 PM"})),(0,i.kt)("h3",{id:"application-positioning"},"Application positioning"),(0,i.kt)("p",null,"Various positions around the cell can be defined as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"stickie_w = 600\nstickie_h = 200\npad = 20\nright = {'x': psize[0] + psize[2] + pad, 'y': psize[1], 'z': 0}\nabove = {'x': psize[0], 'y': psize[1] - stickie_h - pad, 'z': 0}\nleft = {'x': psize[0] - stickie_w - pad, 'y': psize[1], 'z': 0}\nbelow = {'x': psize[0], 'y': psize[1] + psize[3] + pad, 'z': 0}\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/74cba8bd-db69-4534-afc5-2fd952e568b2",alt:"Screenshot 2023-09-20 at 6 39 00 PM"})),(0,i.kt)("h3",{id:"opening-an-asset"},"Opening an asset"),(0,i.kt)("p",null,"You can search an asset and open the matching viewing application. For instance, opening an ImageViewer application\nfor an image file. Remember that each application class has different state values required. Refer to the documentation\nfor more information."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# Get the assets available in this room (shared across boards)\nassets = ps3.list_assets(room_id)\n\nfor f in assets:\n    if f["mimetype"] == "image/jpeg":\n        if f["filename"] == "000000000139.jpg":\n            assetid = f["_id"]\n            state = {"assetid": assetid}\n            ps3.create_app(room_id, board_id, "ImageViewer", state, {\'size\': {\'width\': 600, \'height\': 400, \'depth\': 0}, \'position\': below})\n')),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/0a945348-5691-48d8-b18c-b2c3d5cee527",alt:"Screenshot 2023-09-20 at 6 39 48 PM"})),(0,i.kt)("h3",{id:"opening-a-data-file"},"Opening a data file"),(0,i.kt)("p",null,"You upload data files into the asset manager, such as CSV files. Then, you can load the data into a Pandas dataframe."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# load panda library\nimport pandas as pd\n\n# Get the assets available in this room (shared across boards)\nassets = ps3.list_assets(room_id)\n\nfor f in assets:\n    if f[\"filename\"] == 'airtravel.csv':\n        print('Asset:', f[\"_id\"], 'filename:', f['filename'], 'size:', f['size'], 'type:', f['mimetype'])\n        # the asset I want to retrieve\n        assetid = f[\"_id\"]\n        # build the url\n        url = ps3.get_public_url(assetid)\n        # load the dataframe\n        frame = pd.read_csv(url)\n        print('Frame> ', frame)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/e4f4b0f8-ddfc-494c-8267-61cf0361d79a",alt:"Screenshot 2023-09-24 at 1 24 04 PM"})),(0,i.kt)("h3",{id:"move-and-resize-applications"},"Move and resize applications"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/471faf55-be44-471b-bdbe-c0d0b19cfc4e",alt:"Screenshot 2023-09-20 at 6 42 07 PM"})),(0,i.kt)("p",null,"You can move and resize applications. For instance here, we are scaling the size of each stickies by a factor of 2, and moving\neach one 100 pixels right and 100 pixels down."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'applist = ps3.get_smartbits(room_id, board_id)\nfor _, app in applist:\n    if app.data.type == "Stickie":\n        ps3.update_size(app, app.data.size.width*2, app.data.size.height*2, app.data.size.depth)\n        ps3.update_position(app, app.data.position.x+100, app.data.position.y+100, app.data.position.z)\n')),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/c61ac9f2-f09c-4d83-8d7e-7639f49c5a7a",alt:"Screenshot 2023-09-20 at 6 42 20 PM"})),(0,i.kt)("h3",{id:"get-applications-state"},"Get applications state"),(0,i.kt)("p",null,"Get the list of application in a board, and then list the state object for each one. Each application has a different state object, so explore with caution."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'apps = ps3.get_apps(room_id, board_id)\nfor app in apps:\n    print("App:", app["_id"], app["data"]["type"])\n    if app["data"]["type"] == "Stickie":\n        print("   data> text:", app["data"]["state"]["text"])\n    if app["data"]["type"] == "SageCell":\n        print("   data> language:", app["data"]["state"]["language"])\n    if app["data"]["type"] == "ImageViewer":\n        print("   data> asset:", app["data"]["state"]["assetid"])\n    if app["data"]["type"] == "PDFViewer":\n        print("   data> page#:", app["data"]["state"]["currentPage"])\n    if app["data"]["type"] == "GLTFViewer":\n        print("   data> P/A/D:",\n            app["data"]["state"]["p"], app["data"]["state"]["a"], app["data"]["state"]["d"])\n')),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/SAGE-3/next/assets/5595452/30c1588a-8d51-4f8c-a7fc-c11f42c68341",alt:"Screenshot 2023-09-24 at 4 24 47 PM"})),(0,i.kt)("h2",{id:"api"},"API"),(0,i.kt)("p",null,"The current objects and functions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"PySage3 class: main SAGE3 object"),(0,i.kt)("li",{parentName:"ul"},"create_app"),(0,i.kt)("li",{parentName:"ul"},"delete_app"),(0,i.kt)("li",{parentName:"ul"},"update_size"),(0,i.kt)("li",{parentName:"ul"},"update_position"),(0,i.kt)("li",{parentName:"ul"},"update_rotation"),(0,i.kt)("li",{parentName:"ul"},"list_assets"),(0,i.kt)("li",{parentName:"ul"},"get_public_url"),(0,i.kt)("li",{parentName:"ul"},"get_app"),(0,i.kt)("li",{parentName:"ul"},"get_apps"),(0,i.kt)("li",{parentName:"ul"},"get_apps_by_room"),(0,i.kt)("li",{parentName:"ul"},"get_apps_by_board"),(0,i.kt)("li",{parentName:"ul"},"get_smartbits"),(0,i.kt)("li",{parentName:"ul"},"get_smartbits_by_type"),(0,i.kt)("li",{parentName:"ul"},"get_types_count")),(0,i.kt)("p",null,"Reference: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/SAGE-3/next/blob/dev/foresight/foresight/Sage3Sugar/pysage3.py"},"https://github.com/SAGE-3/next/blob/dev/foresight/foresight/Sage3Sugar/pysage3.py")))}d.isMDXComponent=!0}}]);